---
layout: post
title: 'Project: monitoring recently added books at Safari Books Online'
image: safaribooks.png
summary: Don't miss any book! Using Python/ BeautifulSoup I scrape Safaribooks' recently added page and create a daily (cron) notification email. This pre-work led to me writing my first Twitter bot @newsafaribooks
comments: true
date: 2015-11-09 01:04:34.000000000 +01:00
type: post
published: true
status: publish
categories:
- Books
- Coding
- Projects
tags:
- BeautifulSoup
- books
- html
- parsing
- python
- safaribooks
- webscraping
meta:
  _edit_last: '1'
  _thumbnail_id: '2712'
  _oembed_481fb0f76b3e3e36bf9b11e0fc81b35d: '{{unknown}}'
  _snap_forceSURL: '2'
  snap_MYURL: ''
  snapEdIT: '1'
  featured_posts_widget_flag: 'false'
  _at_widget: '1'
  _oembed_a515747fe32f1fca09b15b510688f2ee: '{{unknown}}'
  _oembed_612b685e1e58fe1d9182a76661d7d1ac: '{{unknown}}'
  _oembed_e1229e2da0c26e1c1146e607fef3281c: '{{unknown}}'
  _oembed_4476ebcfd994743aede6e5b614eb1e3c: '{{unknown}}'
  snap_isAutoPosted: '1'
  _nxs_snap_sh_DL0_1447027484: a:11:{s:7:"dlUName";s:10:"bbelderbos";s:5:"nName";s:4:"Debb";s:6:"dlPass";s:21:"n5g9af4x5n4i4l5b4f444";s:8:"catSelEd";s:0:"";s:11:"dlMsgFormat";s:6:"%TEXT%";s:12:"dlMsgTFormat";s:7:"%TITLE%";s:4:"doDL";i:1;s:6:"catSel";s:1:"0";s:8:"isPosted";s:0:"";s:2:"ii";i:0;s:9:"timeToRun";i:1447027484;}
  _nxs_snap_sh_FB0_1447027477: 'a:23:{s:4:"doFB";i:1;s:5:"nName";s:4:"FBbb";s:7:"fbAppID";s:15:"154002097960796";s:8:"fbAppSec";s:32:"2eadd32d7e5682c3efabd1436db76795";s:8:"catSelEd";s:0:"";s:10:"fbPostType";s:1:"A";s:7:"fbAttch";s:1:"1";s:12:"fbAttchAsVid";i:0;s:6:"imgUpl";s:1:"1";s:11:"fbMsgFormat";s:25:"Blogged:
    %TITLE% - %SURL%";s:10:"fbMsgAFrmt";s:0:"";s:5:"fbURL";s:37:"https://www.facebook.com/bobbelderbos";s:6:"fbPgID";s:12:"bobbelderbos";s:6:"catSel";s:1:"0";s:14:"fbAppAuthToken";s:112:"AAACMEGhX91wBAICJn6YySGUZBMEc6bHMVTSCnrRTwpMBaxQZBPmuPZBrxZCLwV5hgTIj7iBAuODQuZC7IohurUJ3FGPk2MuVLSnuTzj56sAZDZD";s:18:"fbAppPageAuthToken";s:117:"AAACMEGhX91wBAK1osOX6OnH9UDLln8tShukA5BMgy7SWuWJdn3XFzwOZBZCCDwLebZBGj03x7f4h8PoxgXNGm3npp2W5asdUyW71d7F8hYrUZAHS4D9H";s:13:"fbAppAuthUser";s:9:"628517118";s:8:"isPosted";s:0:"";s:8:"imgToUse";b:0;s:8:"urlToUse";b:0;s:8:"postType";s:1:"A";s:2:"ii";i:0;s:9:"timeToRun";i:1447027477;}'
  _nxs_snap_sh_TW0_1447027479: 'a:16:{s:4:"doTW";i:1;s:5:"nName";s:4:"Twbb";s:5:"twURL";s:30:"https://twitter.com/bbelderbos";s:9:"twConsKey";s:22:"yTTWJQa7h0W3ciff6ZQyzg";s:9:"twConsSec";s:40:"MFJXzS2jzvsuZrZPdI0vtueOKBOzur1yZb76N7iE";s:10:"twAccToken";s:50:"177360544-kfNWE0vEciJe3C6F4ZC2kU0nKHXGl8tLr1mMj9cO";s:8:"catSelEd";s:0:"";s:13:"twAccTokenSec";s:40:"Yrr0EWAO0fOJj9ZDU0es4UoQ0371X6D6OTCuvxdw";s:11:"twMsgFormat";s:32:"Blogged:
    %TITLE% - %SURL% %CATS%";s:8:"attchImg";i:0;s:4:"twOK";i:1;s:6:"catSel";s:1:"0";s:8:"isPosted";s:0:"";s:8:"imgToUse";b:0;s:2:"ii";i:0;s:9:"timeToRun";i:1447027479;}'
  snapFB: 's:368:"a:1:{i:0;a:12:{s:4:"doFB";s:1:"1";s:8:"postType";s:1:"A";s:10:"AttachPost";s:1:"1";s:10:"SNAPformat";s:25:"Blogged:
    %TITLE% - %SURL%";s:9:"isAutoImg";s:1:"A";s:8:"imgToUse";s:0:"";s:9:"isAutoURL";s:1:"A";s:8:"urlToUse";s:0:"";s:11:"isPrePosted";s:1:"1";s:8:"isPosted";s:1:"1";s:4:"pgID";s:32:"160267890674014_1056204924413635";s:5:"pDate";s:19:"2015-11-09
    00:04:48";}}";'
  snapTW: 's:288:"a:1:{i:0;a:9:{s:4:"doTW";s:1:"1";s:10:"SNAPformat";s:32:"Blogged:
    %TITLE% - %SURL% %CATS%";s:8:"attchImg";s:1:"0";s:9:"isAutoImg";s:1:"A";s:8:"imgToUse";s:0:"";s:11:"isPrePosted";s:1:"1";s:8:"isPosted";s:1:"1";s:4:"pgID";s:18:"663507499518070784";s:5:"pDate";s:19:"2015-11-09
    00:04:50";}}";'
  snapDL: s:239:"a:1:{i:0;a:7:{s:4:"doDL";s:1:"1";s:11:"SNAPformatT";s:7:"%TITLE%";s:10:"SNAPformat";s:6:"%TEXT%";s:11:"isPrePosted";s:1:"1";s:8:"isPosted";s:1:"1";s:4:"pgID";s:32:"8a990985a99874276fe542b58e6e2040";s:5:"pDate";s:19:"2015-11-09
    00:04:53";}}";
  dsq_thread_id: '4301722215'
  _oembed_f5ba8b810bdd6210fe23239b4478da43: '{{unknown}}'
  _oembed_92c4333e4d11fa77b6252ba3685f26d5: '{{unknown}}'
  _post_restored_from: a:3:{s:20:"restored_revision_id";i:2737;s:16:"restored_by_user";i:1;s:13:"restored_time";i:1447969934;}
author:
  login: bbWebdesign
  email: bobbelderbos@gmail.com
  display_name: Bob
  first_name: Bob
  last_name: Belderbos
---
<p><a href="https://www.safaribooksonline.com" target="_blank">Safari Books Online</a> is awesome, many reasons, worth another blog post. For one thing you get to access the latest and greatest titles even early releases. You can conveniently monitor it <a href="https://www.safaribooksonline.com/explore/new/by-day/" target="_blank">here</a>.</p>
<p>However going to this page every day is cumbersome and there don't seem to be an RSS feed. Hence it was time to set up a notification mailer that grabs the page, parses its content, checks the timestamp (less than 24 hours) and sends a nice html email. You can grab your copy / checkout the code at <a href="https://github.com/bbelderbos/safari" target="_blank">github</a>.</p>
<p>I use the great <a href="http://www.crummy.com/software/BeautifulSoup/" target="_blank">BeautifulSoup</a> plugin as discussed <a href="http://bobbelderbos.com/2012/04/scrape-site-beautifulsoup-python/" target="_blank">previously</a>), including the <a href="https://github.com/html5lib/html5lib-python" target="_blank">html5lib</a>. It's most convenient to run the script in a cron job. I use the -d (daily switch) to get all new titles in the last 24 hours, and use the -w (weekly) once a week to filter on topics that I am interested in. This last execution mode saves me time searching for these filters manually. You can also filter by publisher.</p>
<p>I never get to miss a book this way :)</p>
<p>==</p>
<p>Example of running it with the weekly flag and (-t) filters</p>
<pre># python safarinew.py -wt "Android,mobile,Java,python,hadoop,
big data,security,machine learning,data mining,data science,
mean stack,hacker,hacking,javascript,developer,code,coding" 
-e</pre>
<p>==</p>
<p>CLI flags - usage:</p>
<pre># python safarinew.py -h
Usage: safarinew.py
-c : use cached html (for testing)
-d : see what was added in the last day
-e : send parsed HTML output to comma separated list of emails
-h : print this help
-p : filter on a comma separated list of publishers
-r : refresh the cached html file
-t : filter on a comma separated list of titles
-w : see what was added the last week
Note:
* -d and -w are mutually exclusive
* -t only works with -w (weekly report)
* -c refreshes the cache file if older than 24 hours, use -r to forcefully 
refresh it</pre>
<p>==</p>
<p>Example email:</p>
<p><a href="http://bobbelderbos.com/wp-content/uploads/2015/11/safar_new_books_email.png"><img class="alignnone wp-image-2722 size-full" src="{{ site.baseurl }}/assets/safar_new_books_email.png" alt="safar_new_books_email" width="910" height="514" /></a></p>
<p>==</p>
<p>Enjoy and let me know if you have additional use cases ...</p>
<p>==</p>
<p><strong>Update 09/11/2015:</strong></p>
<p>There is an <a href="https://www.safaribooksonline.com/feeds/recently-added.rss" target="_blank">RSS feed</a> available. It seems richer in content, adding category and book cover and description, so I am definitely going to consume it and see if I can make the notification email information-richer ...</p>
<p>==</p>
<p><strong>Update 10/11/2015:</strong></p>
<p>I made a <a href="https://github.com/bbelderbos/safari/tree/master/rss" target="_blank">new script</a> to parse the mentioned RSS feed which stores each book entry in a <a href="https://docs.python.org/2/library/shelve.html" target="_blank">Python shelve object</a>, then prints (mails) an html output to a list of emails (in a text file). -d specifies how much time to look back, usage and run sample:</p>
<pre># python main.py -h
Usage: main.py [options]
Options:
  -h, --help            show this help message and exit
  -d DAYS_BACK, --daysback=DAYS_BACK
                        number of days to look back
  -m, --mail            send html to recipients
  -t, --test            use local xml for testing
# python main.py -m -d 2
Downloading: <a href="https://www.safaribooksonline.com/feeds/recently-added.rss" target="_blank">https://www.safaribooksonline.<wbr />com/feeds/recently-added.rss
</a>book not in shelve, shelving info for book id 9780134278223
book not in shelve, shelving info for book id 9781466697096
..
..
book not in shelve, shelving info for book id 9781119059578
book not in shelve, shelving info for book id 9780134275796
100 books processed
..
html output
..
..
mailing the output 
..</pre>
<p><a href="http://bobbelderbos.com/wp-content/uploads/2015/11/Screen-Shot-2015-11-10-at-01.09.04.png"><br />
</a>Example output in mailbox:</p>
<p><img class="alignnone wp-image-2727 size-full" src="{{ site.baseurl }}/assets/Screen-Shot-2015-11-10-at-01.09.04.png" alt="Screen Shot 2015-11-10 at 01.09.04" width="735" height="639" /></p>
